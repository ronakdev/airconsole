<html>
  <head>
    <script type="text/javascript" src="https://www.airconsole.com/api/airconsole-1.7.0.js"></script>
    <script type="text/javascript">
      var airconsole;
      var paddles;
      var ball;
      var score = [0, 0];
      var canvas;
      var last = null;
      var score_el;
      /**
       * Sets up the communication to game pads.
       */
      function setupConsole() {
        airconsole = new AirConsole();
        airconsole.onConnect = function(device_id) {
          checkTwoPlayers();
        };
        airconsole.onDisconnect = function(device_id) {
          var player = airconsole.convertDeviceIdToPlayerNumber(device_id);
          if (player != undefined) {
            // Player that was in game left the game.
            // Setting active players to length 0.
            airconsole.setActivePlayers(0);
          }
          checkTwoPlayers();
        };
        airconsole.onMessage = function(device_id, data) {
          var player = airconsole.convertDeviceIdToPlayerNumber(device_id)

          if (player != undefined && data.command !== undefined) {
 			console.log(player)    
         	console.log(data)
         	document.getElementById("data").innerHTML = ("Player: " + player + ", Data: " + data.command)
      		}
        };
      }
      /**
       * Checks if two players are connected!
       */
      function checkTwoPlayers() {
        var active_players = airconsole.getActivePlayerDeviceIds();
        var connected_controllers = airconsole.getControllerDeviceIds();
        // Only update if the game didn't have active players.
        if (active_players.length == 0) {
          if (connected_controllers.length >= 2) {
            // Enough controller devices connected to start the game.
            // Setting the first 2 controllers to active players.
            airconsole.setActivePlayers(2);
            resetBall(50, 0);
            score = [0, 0];
            score_el.innerHTML = score.join(":");
            document.getElementById("wait").innerHTML = "";
          } else if (connected_controllers.length == 1) {
            document.getElementById("wait").innerHTML = "Need 1 more player!";
            resetBall(0, 0);
          } else if (connected_controllers.length == 0) {
            document.getElementById("wait").innerHTML = "Need 2 more players!";
            resetBall(0, 0);
          }
        }
      }
      /**
       * Sends a message to the device that it should vibrate;
       */
      
      /**
       * Shows who scored and updates the score afterwards.
       */
      function displayScore(player) {
        var name = airconsole.getNickname(
            airconsole.convertPlayerNumberToDeviceId(player));
        score_el.innerHTML = "<div style='font-size: 20px;margin-top:16px'>" +
                             name + " scored!</div>";
        window.setTimeout(function() {
          score_el.innerHTML = score.join(":");
        }, 1000);
      }
      /**
       * body.onload function.
       */
      function init() {
        setupConsole();
        // Setting up the game. Nothing AirConsole specific.
        canvas = document.getElementById("canvas");
        score_el = document.getElementById("score");
        paddles = [
          { pos: {x: 10, y: 50}, move: {x: 0, y: 0 },
            el: document.getElementById("player_1") },
          { pos: {x: 190, y: 53}, move: {x: 0, y: 0 },
            el: document.getElementById("player_2") } ];
        ball = { pos: { x: 100, y: 50 }, move: {x: 0, y: 0 },
          el: document.getElementById("ball") };
        canvas.width = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
        window.onresize = (clearCanvas);
        last = new Date().getTime();
        // loop();
      }
      
    </script>
   
  </head>
  <body onload="init()">
    <div class="game">
    <h1 class="data">Nothing Sent</h1>
      <canvas id="canvas"></canvas>
      <div id="score">0:0</div>
      <div id="wait"></div>
    </div>
  </body>
</html>